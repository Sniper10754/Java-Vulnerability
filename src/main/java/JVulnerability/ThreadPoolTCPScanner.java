package JVulnerability;

import JVulnerability.Dipendences.*;
import java.util.ArrayList;

public class ThreadPoolTCPScanner extends Thread {

    private final ThreadPoolRunner runner;
    boolean printout;

    public ThreadPoolTCPScanner(String target, int start, int finish, int timeout, boolean printout) {
        runner = new ThreadPoolRunner(target, start, finish, timeout);
        this.printout = printout;
    }

    @Override
    public void run() {
        // Here's the difficult part, i use a pointer
        runner.start();

        if (printout) {
            int pointer = 0;
            int port;
            String str = "";
            while (runner.isAlive()) {
                WorkerThread[] threadPool = runner.ThreadPool;
                for (int i = 0, threadPoolLength = threadPool.length; i < threadPoolLength; i++) {
                    WorkerThread workerThread = threadPool[i];
                    if (pointer < runner.ThreadPool.length) {
                        if ((port = workerThread.getCurrentPortScan()) != 0) {
                            str = str + " " + workerThread.getName() + ": " + port;
                        } else
                            str = str + " " + workerThread.getName() + ": Finished";
                        try {
                            Thread.sleep(runner.ThreadPool[0].getTimeout() / 2);
                        } catch (InterruptedException ignored) {
                        }
                        pointer++;
                    } else {
                        System.out.println(str);
                        str = "";
                        pointer = 0;
                    }
                }
                System.out.println("\n");
            }
        }
    }

    public ArrayList<Integer> getResults() {
        return runner.getResults();
    }
}
